---
interface Props {
  slug: string;
  permalink: string;
}

const { slug, permalink } = Astro.props;

const url = new URL("https://blog.skywt.cn/api/comments");
url.search = new URLSearchParams({
  page: "1",
  pageSize: "100",
  order: "desc",
  slug: slug,
}).toString();
const response = await fetch(url);
const data = await response.json();
const comments = data.data.dataSet;

import Comment from "./Comment.astro";

function getCount(comments: Comment[]): number {
  let count = 0;
  for (const comment of comments) {
    count++;
    count += getCount(comment.children);
  }
  return count;
}
const commentsNum = getCount(comments);
---

<h2>
  <i class="ri-discuss-line"></i>
  {commentsNum > 0 ? "共 " + commentsNum + " 条评论" : "暂无评论"}
</h2>

{comments.map((comment: Comment) => <Comment commentObj={comment} level={0} />)}

<hr class="my-8" />

<h2>
  <i class="ri-discuss-line"></i>
  发表评论
</h2>
<p class="primary-color card my-4 p-2">
  🚧 新博客系统的评论功能仍在开发中，敬请期待。可以前往<a
    href={permalink}
    class="link underline">原博客的这篇文章</a
  >底部评论区发表评论。
</p>
