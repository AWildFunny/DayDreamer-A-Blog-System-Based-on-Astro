import{r as d}from"./index.NEDEFKed.js";var $={exports:{}},b={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K=d,z=Symbol.for("react.element"),V=Symbol.for("react.fragment"),J=Object.prototype.hasOwnProperty,q=K.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Y={key:!0,ref:!0,__self:!0,__source:!0};function M(e,t,n){var r,a={},c=null,i=null;n!==void 0&&(c=""+n),t.key!==void 0&&(c=""+t.key),t.ref!==void 0&&(i=t.ref);for(r in t)J.call(t,r)&&!Y.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)a[r]===void 0&&(a[r]=t[r]);return{$$typeof:z,type:e,key:c,ref:i,props:a,_owner:q.current}}b.Fragment=V;b.jsx=M;b.jsxs=M;$.exports=b;var o=$.exports;/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var P=W,E=G,B=Object.prototype.toString,j=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function W(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var n={},r=t||{},a=r.decode||Q,c=0;c<e.length;){var i=e.indexOf("=",c);if(i===-1)break;var u=e.indexOf(";",c);if(u===-1)u=e.length;else if(u<i){c=e.lastIndexOf(";",i-1)+1;continue}var m=e.slice(c,i).trim();if(n[m]===void 0){var f=e.slice(i+1,u).trim();f.charCodeAt(0)===34&&(f=f.slice(1,-1)),n[m]=ee(f,a)}c=u+1}return n}function G(e,t,n){var r=n||{},a=r.encode||X;if(typeof a!="function")throw new TypeError("option encode is invalid");if(!j.test(e))throw new TypeError("argument name is invalid");var c=a(t);if(c&&!j.test(c))throw new TypeError("argument val is invalid");var i=e+"="+c;if(r.maxAge!=null){var u=r.maxAge-0;if(isNaN(u)||!isFinite(u))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(u)}if(r.domain){if(!j.test(r.domain))throw new TypeError("option domain is invalid");i+="; Domain="+r.domain}if(r.path){if(!j.test(r.path))throw new TypeError("option path is invalid");i+="; Path="+r.path}if(r.expires){var m=r.expires;if(!Z(m)||isNaN(m.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+m.toUTCString()}if(r.httpOnly&&(i+="; HttpOnly"),r.secure&&(i+="; Secure"),r.partitioned&&(i+="; Partitioned"),r.priority){var f=typeof r.priority=="string"?r.priority.toLowerCase():r.priority;switch(f){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(r.sameSite){var g=typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite;switch(g){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return i}function Q(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function X(e){return encodeURIComponent(e)}function Z(e){return B.call(e)==="[object Date]"||e instanceof Date}function ee(e,t){try{return t(e)}catch{return e}}function te(){const e=typeof global>"u"?void 0:global.TEST_HAS_DOCUMENT_COOKIE;return typeof e=="boolean"?e:typeof document=="object"&&typeof document.cookie=="string"}function re(e){return typeof e=="string"?P(e):typeof e=="object"&&e!==null?e:{}}function O(e,t={}){const n=ne(e);if(!t.doNotParse)try{return JSON.parse(n)}catch{}return e}function ne(e){return e&&e[0]==="j"&&e[1]===":"?e.substr(2):e}class L{constructor(t,n={}){this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.update=()=>{if(!this.HAS_DOCUMENT_COOKIE)return;const a=this.cookies;this.cookies=P(document.cookie),this._checkChanges(a)};const r=typeof document>"u"?"":document.cookie;this.cookies=re(t||r),this.defaultSetOptions=n,this.HAS_DOCUMENT_COOKIE=te()}_emitChange(t){for(let n=0;n<this.changeListeners.length;++n)this.changeListeners[n](t)}_checkChanges(t){new Set(Object.keys(t).concat(Object.keys(this.cookies))).forEach(r=>{t[r]!==this.cookies[r]&&this._emitChange({name:r,value:O(this.cookies[r])})})}_startPolling(){this.pollingInterval=setInterval(this.update,300)}_stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}get(t,n={}){return n.doNotUpdate||this.update(),O(this.cookies[t],n)}getAll(t={}){t.doNotUpdate||this.update();const n={};for(let r in this.cookies)n[r]=O(this.cookies[r],t);return n}set(t,n,r){r?r=Object.assign(Object.assign({},this.defaultSetOptions),r):r=this.defaultSetOptions;const a=typeof n=="string"?n:JSON.stringify(n);this.cookies=Object.assign(Object.assign({},this.cookies),{[t]:a}),this.HAS_DOCUMENT_COOKIE&&(document.cookie=E(t,a,r)),this._emitChange({name:t,value:n,options:r})}remove(t,n){const r=n=Object.assign(Object.assign(Object.assign({},this.defaultSetOptions),n),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=Object.assign({},this.cookies),delete this.cookies[t],this.HAS_DOCUMENT_COOKIE&&(document.cookie=E(t,"",r)),this._emitChange({name:t,value:void 0,options:n})}addChangeListener(t){this.changeListeners.push(t),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===1&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.addEventListener("change",this.update):this._startPolling())}removeChangeListener(t){const n=this.changeListeners.indexOf(t);n>=0&&this.changeListeners.splice(n,1),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===0&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.removeEventListener("change",this.update):this._stopPolling())}}const A=d.createContext(new L),{Provider:se,Consumer:pe}=A;class oe extends d.Component{constructor(t){super(t),t.cookies?this.cookies=t.cookies:this.cookies=new L(void 0,t.defaultSetOptions)}render(){return d.createElement(se,{value:this.cookies},this.props.children)}}var R={exports:{}},l={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N;function ie(){if(N)return l;N=1;var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,n=e?Symbol.for("react.portal"):60106,r=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,c=e?Symbol.for("react.profiler"):60114,i=e?Symbol.for("react.provider"):60109,u=e?Symbol.for("react.context"):60110,m=e?Symbol.for("react.async_mode"):60111,f=e?Symbol.for("react.concurrent_mode"):60111,g=e?Symbol.for("react.forward_ref"):60112,x=e?Symbol.for("react.suspense"):60113,S=e?Symbol.for("react.suspense_list"):60120,h=e?Symbol.for("react.memo"):60115,C=e?Symbol.for("react.lazy"):60116,w=e?Symbol.for("react.block"):60121,p=e?Symbol.for("react.fundamental"):60117,v=e?Symbol.for("react.responder"):60118,H=e?Symbol.for("react.scope"):60119;function y(s){if(typeof s=="object"&&s!==null){var k=s.$$typeof;switch(k){case t:switch(s=s.type,s){case m:case f:case r:case c:case a:case x:return s;default:switch(s=s&&s.$$typeof,s){case u:case g:case C:case h:case i:return s;default:return k}}case n:return k}}}function _(s){return y(s)===f}return l.AsyncMode=m,l.ConcurrentMode=f,l.ContextConsumer=u,l.ContextProvider=i,l.Element=t,l.ForwardRef=g,l.Fragment=r,l.Lazy=C,l.Memo=h,l.Portal=n,l.Profiler=c,l.StrictMode=a,l.Suspense=x,l.isAsyncMode=function(s){return _(s)||y(s)===m},l.isConcurrentMode=_,l.isContextConsumer=function(s){return y(s)===u},l.isContextProvider=function(s){return y(s)===i},l.isElement=function(s){return typeof s=="object"&&s!==null&&s.$$typeof===t},l.isForwardRef=function(s){return y(s)===g},l.isFragment=function(s){return y(s)===r},l.isLazy=function(s){return y(s)===C},l.isMemo=function(s){return y(s)===h},l.isPortal=function(s){return y(s)===n},l.isProfiler=function(s){return y(s)===c},l.isStrictMode=function(s){return y(s)===a},l.isSuspense=function(s){return y(s)===x},l.isValidElementType=function(s){return typeof s=="string"||typeof s=="function"||s===r||s===f||s===c||s===a||s===x||s===S||typeof s=="object"&&s!==null&&(s.$$typeof===C||s.$$typeof===h||s.$$typeof===i||s.$$typeof===u||s.$$typeof===g||s.$$typeof===p||s.$$typeof===v||s.$$typeof===H||s.$$typeof===w)},l.typeOf=y,l}R.exports=ie();var ae=R.exports,D=ae,ce={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},le={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},U={};U[D.ForwardRef]=ce;U[D.Memo]=le;function ue(){return typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"}function me(e){const t=d.useContext(A);if(!t)throw new Error("Missing <CookiesProvider>");const[n,r]=d.useState(()=>t.getAll({doNotUpdate:!0}));ue()&&d.useLayoutEffect(()=>{function u(){const m=t.getAll({doNotUpdate:!0});de(e||null,m,n)&&r(m)}return t.addChangeListener(u),()=>{t.removeChangeListener(u)}},[t,n]);const a=d.useMemo(()=>t.set.bind(t),[t]),c=d.useMemo(()=>t.remove.bind(t),[t]),i=d.useMemo(()=>t.update.bind(t),[t]);return[n,a,c,i]}function de(e,t,n){if(!e)return!0;for(let r of e)if(t[r]!==n[r])return!0;return!1}function I(e){const[t,n]=d.useState(""),[r,a]=d.useState(""),[c,i]=d.useState(""),[u,m]=d.useState(""),[f,g]=d.useState(!0),[x,S]=d.useState(!0),[h,C,w]=me(["author","mail","url"]);return d.useEffect(()=>{h.author&&(n(h.author),S(!1)),h.mail&&a(h.mail),h.url&&i(h.url)},[]),o.jsxs(o.Fragment,{children:[e.selected!==null&&o.jsxs("div",{className:"mt-4 flex justify-between",children:[o.jsxs("p",{className:"primary-color font-bold",children:[o.jsx("i",{className:"ri-reply-line"})," 回复 @",e.selected.author," ","的评论："]}),o.jsx("p",{children:o.jsx("span",{className:"link",onClick:()=>{e.setSelected(null)},children:"取消回复"})})]}),o.jsxs("p",{className:"mt-4 primary-color card p-2",children:[o.jsx("i",{className:"ri-information-line"})," ",o.jsx("b",{children:"所有评论都将经过博主审核。"}),"请勿填写无意义邮箱或发表无关评论、广告等，否则会被视为垃圾评论。",o.jsx("br",{}),"评论提交组件是最近刚写的，如果遇到 bug 欢迎向博主反馈～"]}),o.jsxs("form",{onSubmit:p=>{e.submitComment(t,r,c,u,f),m(""),p.preventDefault()},className:"mt-4 grid gap-4 grid-cols-1 sm:grid-cols-3 relative",children:[o.jsx("input",{placeholder:"你的名字",type:"text",required:!0,value:t,onChange:p=>{n(p.target.value)}}),o.jsx("input",{placeholder:"邮箱",type:"email",required:!0,value:r,onChange:p=>{a(p.target.value)}}),o.jsx("input",{placeholder:"网址",type:"url",value:c,onChange:p=>{i(p.target.value)}}),o.jsx("textarea",{rows:8,className:"sm:col-span-3",placeholder:"说点什么吧……",required:!0,value:u,onChange:p=>{m(p.target.value)}}),o.jsx("button",{type:"submit",className:"sm:col-span-3",disabled:e.sending,children:e.sending?"提交中……":"提交"})]}),x&&o.jsxs("p",{className:"mt-4 secondary-color text-sm leading-normal",children:["提交评论即表明你同意本网站使用 Cookie，并允许本站在后台记录你的邮箱、IP 地址等必要信息。",o.jsx("br",{}),"（提交一次评论后，本提示将不再展示）"]})]})}const fe={formatTimestamp:function(e){const t=new Date(e),n=t.getFullYear(),r=t.getMonth()+1,a=t.getDate(),c=t.getHours().toString().padStart(2,"0"),i=t.getMinutes().toString().padStart(2,"0");return`${n} 年 ${r} 月 ${a} 日 ${c}:${i}`},formatMonthDay:function(e){const t=new Date(e),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${n}-${r}`}};function F(e){return o.jsxs("div",{className:"primary-color my-4",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("img",{src:e.comment.avatar,className:"rounded-full w-12 mr-2"}),o.jsxs("div",{className:"m-2",children:[e.comment.url?o.jsx("a",{href:e.comment.url,className:"link",target:"_blank",children:o.jsx("h4",{children:e.comment.author})}):o.jsx("h4",{children:e.comment.author}),o.jsxs("p",{className:"mt-1",children:[o.jsx("span",{className:"secondary-color",children:fe.formatTimestamp(e.comment.created)}),e.comment.status==="approved"?o.jsxs("span",{className:"link ml-2 primary-color",onClick:()=>{e.setSelected(e.comment)},children:[o.jsx("i",{className:"ri-reply-line"})," 回复"]}):o.jsxs("span",{className:"ml-2 primary-color",children:[o.jsx("i",{className:"ri-admin-line"})," 待审核"]})]})]})]}),o.jsx("p",{className:"mt-2 break-all",children:e.comment.text}),e.comment===e.selected&&o.jsx(I,{selected:e.selected,setSelected:e.setSelected,submitComment:e.submitComment,sending:e.sending}),o.jsx("div",{className:"ml-8",children:e.comment.children.map(t=>o.jsx(F,{selected:e.selected,comment:t,setSelected:e.setSelected,submitComment:e.submitComment,sending:e.sending},t.coid))})]})}const T={getTimeline:async(e,t)=>{const n=new URL("timeline","https://api.skywt.cn/");return n.search=new URLSearchParams({page:e.toString(),pageSize:t.toString()}).toString(),await(await fetch(n)).json()},getArticle:async e=>{const t=new URL(`article/${e}`,"https://api.skywt.cn/");return await(await fetch(t)).json()},getComments:async e=>{const t=new URL(`article/${e}/comments`,"https://api.skywt.cn/");return await(await fetch(t,{method:"GET",credentials:"include"})).json()},postComments:async(e,t,n,r,a,c,i)=>{const u=new URL(`article/${e}/comments`,"https://api.skywt.cn/"),m={text:a,author:t,mail:n,url:r,receiveMail:c,parent:i?i.coid:0},f=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(m)});if(f.ok===!1)throw Error("HTTP Error "+f.status+" "+f.statusText);return await f.json()}};function ye(e){const[t,n]=d.useState([]),[r,a]=d.useState(!1),[c,i]=d.useState(0),[u,m]=d.useState(null),[f,g]=d.useState(!1);async function x(S,h,C,w,p){if(f!==!0){g(!0);try{const v=await T.postComments(e.slug,S,h,C,w,p,u);u!==null?u.children.push(v):t.push(v),n([...t]),g(!1),m(null)}catch{console.log("Error: ",r),alert("抱歉，评论发送失败。"),g(!1)}}}return d.useEffect(()=>{function S(h){let C=0;return h.forEach(w=>{C++,C+=S(w.children)}),C}T.getComments(e.slug).then(h=>{n(h),i(S(h))}).catch(h=>{console.log("Error: ",h),a(!0)})},[]),o.jsxs(oe,{defaultSetOptions:{path:"/",maxAge:2592e3,sameSite:"lax",domain:".skywt.cn"},children:[r?o.jsxs(o.Fragment,{children:[o.jsxs("h2",{children:[o.jsx("i",{className:"ri-discuss-line"})," 评论"]}),o.jsx("p",{className:"primary-color card my-4 p-2",children:"🚧 抱歉，获取评论失败。"})]}):o.jsxs(o.Fragment,{children:[o.jsxs("h2",{children:[o.jsx("i",{className:"ri-discuss-line"}),c>0?" 共 "+c+" 条评论":" 暂无评论"]}),t.map(S=>o.jsx(F,{comment:S,selected:u,setSelected:m,submitComment:x,sending:f},S.coid))]}),o.jsx("hr",{className:"my-8"}),o.jsxs("h2",{children:[o.jsx("i",{className:"ri-discuss-line"})," 发表新的评论"]}),u===null?o.jsx(I,{selected:u,setSelected:m,submitComment:x,sending:f}):o.jsx("div",{className:"mt-4",children:o.jsx("span",{className:"link underline primary-color",onClick:()=>{m(null)},children:"取消评论回复"})})]})}export{ye as default};
