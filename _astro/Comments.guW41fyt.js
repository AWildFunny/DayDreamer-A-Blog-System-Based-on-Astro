import{r as m}from"./index.NEDEFKed.js";var $={exports:{}},v={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K=m,z=Symbol.for("react.element"),V=Symbol.for("react.fragment"),J=Object.prototype.hasOwnProperty,q=K.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Y={key:!0,ref:!0,__self:!0,__source:!0};function M(e,t,r){var n,a={},c=null,i=null;r!==void 0&&(c=""+r),t.key!==void 0&&(c=""+t.key),t.ref!==void 0&&(i=t.ref);for(n in t)J.call(t,n)&&!Y.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:z,type:e,key:c,ref:i,props:a,_owner:q.current}}v.Fragment=V;v.jsx=M;v.jsxs=M;$.exports=v;var o=$.exports;/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */var P=W,E=G,B=Object.prototype.toString,j=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function W(e,t){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var r={},n=t||{},a=n.decode||Q,c=0;c<e.length;){var i=e.indexOf("=",c);if(i===-1)break;var l=e.indexOf(";",c);if(l===-1)l=e.length;else if(l<i){c=e.lastIndexOf(";",i-1)+1;continue}var d=e.slice(c,i).trim();if(r[d]===void 0){var f=e.slice(i+1,l).trim();f.charCodeAt(0)===34&&(f=f.slice(1,-1)),r[d]=ee(f,a)}c=l+1}return r}function G(e,t,r){var n=r||{},a=n.encode||X;if(typeof a!="function")throw new TypeError("option encode is invalid");if(!j.test(e))throw new TypeError("argument name is invalid");var c=a(t);if(c&&!j.test(c))throw new TypeError("argument val is invalid");var i=e+"="+c;if(n.maxAge!=null){var l=n.maxAge-0;if(isNaN(l)||!isFinite(l))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(l)}if(n.domain){if(!j.test(n.domain))throw new TypeError("option domain is invalid");i+="; Domain="+n.domain}if(n.path){if(!j.test(n.path))throw new TypeError("option path is invalid");i+="; Path="+n.path}if(n.expires){var d=n.expires;if(!Z(d)||isNaN(d.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+d.toUTCString()}if(n.httpOnly&&(i+="; HttpOnly"),n.secure&&(i+="; Secure"),n.partitioned&&(i+="; Partitioned"),n.priority){var f=typeof n.priority=="string"?n.priority.toLowerCase():n.priority;switch(f){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(n.sameSite){var g=typeof n.sameSite=="string"?n.sameSite.toLowerCase():n.sameSite;switch(g){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return i}function Q(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function X(e){return encodeURIComponent(e)}function Z(e){return B.call(e)==="[object Date]"||e instanceof Date}function ee(e,t){try{return t(e)}catch{return e}}function te(){const e=typeof global>"u"?void 0:global.TEST_HAS_DOCUMENT_COOKIE;return typeof e=="boolean"?e:typeof document=="object"&&typeof document.cookie=="string"}function ne(e){return typeof e=="string"?P(e):typeof e=="object"&&e!==null?e:{}}function k(e,t={}){const r=re(e);if(!t.doNotParse)try{return JSON.parse(r)}catch{}return e}function re(e){return e&&e[0]==="j"&&e[1]===":"?e.substr(2):e}class L{constructor(t,r={}){this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.update=()=>{if(!this.HAS_DOCUMENT_COOKIE)return;const a=this.cookies;this.cookies=P(document.cookie),this._checkChanges(a)};const n=typeof document>"u"?"":document.cookie;this.cookies=ne(t||n),this.defaultSetOptions=r,this.HAS_DOCUMENT_COOKIE=te()}_emitChange(t){for(let r=0;r<this.changeListeners.length;++r)this.changeListeners[r](t)}_checkChanges(t){new Set(Object.keys(t).concat(Object.keys(this.cookies))).forEach(n=>{t[n]!==this.cookies[n]&&this._emitChange({name:n,value:k(this.cookies[n])})})}_startPolling(){this.pollingInterval=setInterval(this.update,300)}_stopPolling(){this.pollingInterval&&clearInterval(this.pollingInterval)}get(t,r={}){return r.doNotUpdate||this.update(),k(this.cookies[t],r)}getAll(t={}){t.doNotUpdate||this.update();const r={};for(let n in this.cookies)r[n]=k(this.cookies[n],t);return r}set(t,r,n){n?n=Object.assign(Object.assign({},this.defaultSetOptions),n):n=this.defaultSetOptions;const a=typeof r=="string"?r:JSON.stringify(r);this.cookies=Object.assign(Object.assign({},this.cookies),{[t]:a}),this.HAS_DOCUMENT_COOKIE&&(document.cookie=E(t,a,n)),this._emitChange({name:t,value:r,options:n})}remove(t,r){const n=r=Object.assign(Object.assign(Object.assign({},this.defaultSetOptions),r),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=Object.assign({},this.cookies),delete this.cookies[t],this.HAS_DOCUMENT_COOKIE&&(document.cookie=E(t,"",n)),this._emitChange({name:t,value:void 0,options:r})}addChangeListener(t){this.changeListeners.push(t),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===1&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.addEventListener("change",this.update):this._startPolling())}removeChangeListener(t){const r=this.changeListeners.indexOf(t);r>=0&&this.changeListeners.splice(r,1),this.HAS_DOCUMENT_COOKIE&&this.changeListeners.length===0&&(typeof window=="object"&&"cookieStore"in window?window.cookieStore.removeEventListener("change",this.update):this._stopPolling())}}const A=m.createContext(new L),{Provider:se,Consumer:Ce}=A;class oe extends m.Component{constructor(t){super(t),t.cookies?this.cookies=t.cookies:this.cookies=new L(void 0,t.defaultSetOptions)}render(){return m.createElement(se,{value:this.cookies},this.props.children)}}var R={exports:{}},u={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N;function ie(){if(N)return u;N=1;var e=typeof Symbol=="function"&&Symbol.for,t=e?Symbol.for("react.element"):60103,r=e?Symbol.for("react.portal"):60106,n=e?Symbol.for("react.fragment"):60107,a=e?Symbol.for("react.strict_mode"):60108,c=e?Symbol.for("react.profiler"):60114,i=e?Symbol.for("react.provider"):60109,l=e?Symbol.for("react.context"):60110,d=e?Symbol.for("react.async_mode"):60111,f=e?Symbol.for("react.concurrent_mode"):60111,g=e?Symbol.for("react.forward_ref"):60112,w=e?Symbol.for("react.suspense"):60113,S=e?Symbol.for("react.suspense_list"):60120,h=e?Symbol.for("react.memo"):60115,C=e?Symbol.for("react.lazy"):60116,x=e?Symbol.for("react.block"):60121,p=e?Symbol.for("react.fundamental"):60117,b=e?Symbol.for("react.responder"):60118,H=e?Symbol.for("react.scope"):60119;function y(s){if(typeof s=="object"&&s!==null){var _=s.$$typeof;switch(_){case t:switch(s=s.type,s){case d:case f:case n:case c:case a:case w:return s;default:switch(s=s&&s.$$typeof,s){case l:case g:case C:case h:case i:return s;default:return _}}case r:return _}}}function O(s){return y(s)===f}return u.AsyncMode=d,u.ConcurrentMode=f,u.ContextConsumer=l,u.ContextProvider=i,u.Element=t,u.ForwardRef=g,u.Fragment=n,u.Lazy=C,u.Memo=h,u.Portal=r,u.Profiler=c,u.StrictMode=a,u.Suspense=w,u.isAsyncMode=function(s){return O(s)||y(s)===d},u.isConcurrentMode=O,u.isContextConsumer=function(s){return y(s)===l},u.isContextProvider=function(s){return y(s)===i},u.isElement=function(s){return typeof s=="object"&&s!==null&&s.$$typeof===t},u.isForwardRef=function(s){return y(s)===g},u.isFragment=function(s){return y(s)===n},u.isLazy=function(s){return y(s)===C},u.isMemo=function(s){return y(s)===h},u.isPortal=function(s){return y(s)===r},u.isProfiler=function(s){return y(s)===c},u.isStrictMode=function(s){return y(s)===a},u.isSuspense=function(s){return y(s)===w},u.isValidElementType=function(s){return typeof s=="string"||typeof s=="function"||s===n||s===f||s===c||s===a||s===w||s===S||typeof s=="object"&&s!==null&&(s.$$typeof===C||s.$$typeof===h||s.$$typeof===i||s.$$typeof===l||s.$$typeof===g||s.$$typeof===p||s.$$typeof===b||s.$$typeof===H||s.$$typeof===x)},u.typeOf=y,u}R.exports=ie();var ae=R.exports,D=ae,ce={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},le={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},I={};I[D.ForwardRef]=ce;I[D.Memo]=le;function ue(){return typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"}function me(e){const t=m.useContext(A);if(!t)throw new Error("Missing <CookiesProvider>");const[r,n]=m.useState(()=>t.getAll({doNotUpdate:!0}));ue()&&m.useLayoutEffect(()=>{function l(){const d=t.getAll({doNotUpdate:!0});de(e||null,d,r)&&n(d)}return t.addChangeListener(l),()=>{t.removeChangeListener(l)}},[t,r]);const a=m.useMemo(()=>t.set.bind(t),[t]),c=m.useMemo(()=>t.remove.bind(t),[t]),i=m.useMemo(()=>t.update.bind(t),[t]);return[r,a,c,i]}function de(e,t,r){if(!e)return!0;for(let n of e)if(t[n]!==r[n])return!0;return!1}function U(e){const[t,r]=m.useState(""),[n,a]=m.useState(""),[c,i]=m.useState(""),[l,d]=m.useState(""),[f,g]=m.useState(!0),[w,S]=m.useState(!0),[h,C,x]=me(["author","mail","url"]);return m.useEffect(()=>{h.author&&(r(h.author),S(!1)),h.mail&&a(h.mail),h.url&&i(h.url)},[]),o.jsxs(o.Fragment,{children:[e.selected!==null&&o.jsxs("div",{className:"mt-4 flex justify-between",children:[o.jsxs("p",{className:"font-bold",children:[o.jsx("i",{className:"ri-reply-line"})," 回复 @",e.selected.author," ","的评论："]}),o.jsx("p",{children:o.jsx("span",{className:"link",onClick:()=>{e.setSelected(null)},children:"取消回复"})})]}),o.jsxs("p",{className:"mt-4 card card--in-content",children:[o.jsx("b",{children:"所有评论都将经过博主审核。"}),"请勿填写无意义邮箱或发表无关评论、广告等，否则会被视为垃圾评论。"]}),o.jsxs("form",{onSubmit:p=>{e.submitComment(t,n,c,l,f),d(""),p.preventDefault()},className:"mt-4 form",children:[o.jsx("input",{placeholder:"你的名字",type:"text",className:"form__input",required:!0,value:t,onChange:p=>{r(p.target.value)}}),o.jsx("input",{placeholder:"邮箱",type:"email",className:"form__input",required:!0,value:n,onChange:p=>{a(p.target.value)}}),o.jsx("input",{placeholder:"网址",type:"url",className:"form__input",value:c,onChange:p=>{i(p.target.value)}}),o.jsx("textarea",{rows:8,className:"sm:col-span-3 form__input",placeholder:"说点什么吧……",required:!0,value:l,onChange:p=>{d(p.target.value)}}),o.jsx("button",{type:"submit",className:"sm:col-span-3 form__button",disabled:e.sending,children:e.sending?"提交中……":"提交"})]}),w&&o.jsx("p",{className:"mt-4 text-secondary text-sm leading-normal",children:"提交评论即表明你同意本网站使用 Cookie，并允许本站在后台记录你的邮箱、IP 地址等必要信息。这些信息不会被透露给其他用户。（提交一次评论后，本提示将不再展示）"})]})}const fe={getFullDate:e=>{e=new Date(e);const t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate(),a=e.getHours().toString().padStart(2,"0"),c=e.getMinutes().toString().padStart(2,"0");return`${t} 年 ${r} 月 ${n} 日 ${a}:${c}`},getMonthDay:e=>{e=new Date(e);const t=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${t}-${r}`}};function F(e){return o.jsxs("div",{className:"my-4",children:[o.jsxs("div",{className:"flex items-center",children:[o.jsx("img",{src:e.comment.avatar,className:"rounded-full w-12 mr-2"}),o.jsxs("div",{className:"m-2",children:[e.comment.url?o.jsx("a",{href:e.comment.url,className:"link",target:"_blank",children:o.jsx("h4",{children:e.comment.author})}):o.jsx("h4",{children:e.comment.author}),o.jsxs("p",{className:"mt-1",children:[o.jsx("span",{className:"text-secondary",children:fe.getFullDate(e.comment.created)}),e.comment.status==="approved"?o.jsxs("span",{className:"link ml-2",onClick:()=>{e.setSelected(e.comment)},children:[o.jsx("i",{className:"ri-reply-line"})," 回复"]}):o.jsxs("span",{className:"ml-2",children:[o.jsx("i",{className:"ri-admin-line"})," 待审核"]})]})]})]}),o.jsx("p",{className:"mt-2 break-all whitespace-pre-wrap",children:e.comment.text}),e.comment===e.selected&&o.jsx(U,{selected:e.selected,setSelected:e.setSelected,submitComment:e.submitComment,sending:e.sending}),o.jsx("div",{className:"ml-8",children:e.comment.children.map(t=>o.jsx(F,{selected:e.selected,comment:t,setSelected:e.setSelected,submitComment:e.submitComment,sending:e.sending},t.id))})]})}const he=async e=>{const t=new URL(`articles/${e}`,"https://api.skywt.cn/");return(await(await fetch(t)).json()).data},pe=async(e,t)=>{const r=new URL("articles","https://api.skywt.cn/");return r.search=new URLSearchParams({page:e.toString(),pageSize:t.toString()}).toString(),(await(await fetch(r)).json()).data},ye=async e=>{const t=new URL("comments","https://api.skywt.cn/");return t.search=new URLSearchParams({articleId:e.toString()}).toString(),(await(await fetch(t,{method:"GET",credentials:"include"})).json()).data},ge=async(e,t,r,n,a,c,i)=>{const l=new URL("comments","https://api.skywt.cn/"),f=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({author:e,mail:t,url:r,text:n,receiveMail:a,articleId:c,parentId:i})});if(f.ok===!1)throw Error("HTTP Error "+f.status+" "+f.statusText);return(await f.json()).data},T={getArticle:he,getArticles:pe,getComments:ye,postComment:ge};function we(e){const[t,r]=m.useState([]),[n,a]=m.useState(!1),[c,i]=m.useState(0),[l,d]=m.useState(null),[f,g]=m.useState(!1);async function w(S,h,C,x,p){if(f!==!0){g(!0);try{const b=await T.postComment(S,h,C,x,p,e.articleId,l===null?null:l.id);l!==null?l.children.push(b):t.push(b),r([...t]),g(!1),d(null)}catch{console.log("Error: ",n),alert("抱歉，评论发送失败。"),g(!1)}}}return m.useEffect(()=>{function S(h){let C=0;return h.forEach(x=>{C++,C+=S(x.children)}),C}T.getComments(e.articleId).then(h=>{r(h),i(S(h))}).catch(h=>{console.log("Error: ",h),a(!0)})},[]),o.jsxs(oe,{defaultSetOptions:{path:"/",maxAge:2592e3,sameSite:"lax",domain:".skywt.cn"},children:[n?o.jsxs("section",{className:"page__section",children:[o.jsxs("h2",{children:[o.jsx("i",{className:"ri-discuss-line"})," 评论"]}),o.jsx("p",{className:"card card--in-content my-4",children:"🚧 抱歉，获取评论失败。"})]}):o.jsxs("section",{className:"page__section",children:[o.jsxs("h2",{children:[o.jsx("i",{className:"ri-discuss-line"}),c>0?" 共 "+c+" 条评论":" 暂无评论"]}),t.map(S=>o.jsx(F,{comment:S,selected:l,setSelected:d,submitComment:w,sending:f},S.id))]}),o.jsx("hr",{className:"page__divide page__divide--between-sections"}),o.jsxs("section",{className:"page__section",children:[o.jsxs("h2",{children:[o.jsx("i",{className:"ri-discuss-line"})," 发表新的评论"]}),l===null?o.jsx(U,{selected:l,setSelected:d,submitComment:w,sending:f}):o.jsx("div",{className:"mt-4",children:o.jsx("span",{className:"link underline",onClick:()=>{d(null)},children:"取消评论回复"})})]})]})}export{we as default};
